'use strict';var Code={};Code.LANGUAGE_NAME={'zh-hans':'简体中文'};Code.LANGUAGE_RTL=['ar','fa','he','lki'];Code.workspace=null;Code.getStringParamFromUrl=function(name,defaultValue){var val=location.search.match(new RegExp('[?&]'+name+'=([^&]+)'));return val?decodeURIComponent(val[1].replace(/\+/g,'%20')):defaultValue};Code.getLang=function(){var lang=Code.getStringParamFromUrl('lang','');if(Code.LANGUAGE_NAME[lang]===undefined){lang='zh-hans'}return lang};Code.isRtl=function(){return Code.LANGUAGE_RTL.indexOf(Code.LANG)!=-1};Code.loadBlocks=function(defaultXml){try{var loadOnce=window.sessionStorage.loadOnceBlocks}catch(e){var loadOnce=null}if('BlocklyStorage'in window&&window.location.hash.length>1){BlocklyStorage.retrieveXml(window.location.hash.substring(1))}else if(loadOnce){delete window.sessionStorage.loadOnceBlocks;var xml=Blockly.Xml.textToDom(loadOnce);Blockly.Xml.domToWorkspace(xml,Code.workspace)}else if(defaultXml){var xml=Blockly.Xml.textToDom(defaultXml);Blockly.Xml.domToWorkspace(xml,Code.workspace)}else if('BlocklyStorage'in window){window.setTimeout(BlocklyStorage.restoreBlocks,0)}};Code.changeLanguage=function(){if(typeof Blockly!='undefined'&&window.sessionStorage){var xml=Blockly.Xml.workspaceToDom(Code.workspace);var text=Blockly.Xml.domToText(xml);window.sessionStorage.loadOnceBlocks=text}};Code.bindClick=function(el,func){if(typeof el=='string'){el=document.getElementById(el)}el.addEventListener('click',func,true);el.addEventListener('touchend',func,true)};Code.getBBox_=function(element){var height=element.offsetHeight;var width=element.offsetWidth;var x=0;var y=0;do{x+=element.offsetLeft;y+=element.offsetTop;element=element.offsetParent}while(element);return{height:height,width:width,x:x,y:y}};Code.LANG=Code.getLang();Code.TABS_=['blocks'];Code.selected='blocks';Code.tabClick=function(clickedName){if(document.getElementById('tab_blocks').className=='tabon'){Code.workspace.setVisible(false)}for(var i=0;i<Code.TABS_.length;i++){var name=Code.TABS_[i];document.getElementById('tab_'+name).className='taboff';document.getElementById('content_'+name).style.visibility='hidden'}Code.selected=clickedName;document.getElementById('tab_'+clickedName).className='tabon';document.getElementById('content_'+clickedName).style.visibility='visible';Code.renderContent();if(clickedName=='blocks'){Code.workspace.setVisible(true)}Blockly.svgResize(Code.workspace)};Code.renderContent=function(){var content=document.getElementById('content_'+Code.selected)};Code.init=function(){Code.initLanguage();Code.scrolledPos=0;var rtl=Code.isRtl();var container=document.getElementById('content_area');var onresize=function(e){var bBox=Code.getBBox_(container);for(var i=0;i<Code.TABS_.length;i++){var el=document.getElementById('content_'+Code.TABS_[i]);el.style.top=bBox.y+'px';el.style.left=bBox.x+'px';el.style.height=bBox.height+'px';el.style.height=(2*bBox.height-el.offsetHeight)+'px'}if(Code.workspace&&Code.workspace.toolbox_.width){}};window.addEventListener('resize',onresize,false);for(var messageKey in MSG){if(goog.string.startsWith(messageKey,'cat')){Blockly.Msg[messageKey.toUpperCase()]=MSG[messageKey]}}var toolboxText=document.getElementById('toolbox').innerHTML;var toolboxXml=Blockly.Xml.textToDom(toolboxText);Code.workspace=Blockly.inject('content_blocks',{grid:{spacing:20,length:2,colour:'#ccc',snap:true},media:'media/',rtl:rtl,toolbox:toolboxXml,zoom:{controls:true,wheel:true}});Blockly.JavaScript.addReservedWords('code,timeouts,checkTimeout');Code.loadBlocks('');if('BlocklyStorage'in window){BlocklyStorage.backupOnUnload(Code.workspace)}Code.tabClick(Code.selected);onresize();Blockly.svgResize(Code.workspace);window.setTimeout(Code.importPrettify,1)};Code.initLanguage=function(){var rtl=Code.isRtl();document.dir=rtl?'rtl':'ltr';document.head.parentElement.setAttribute('lang',Code.LANG);var languages=[];for(var lang in Code.LANGUAGE_NAME){languages.push([Code.LANGUAGE_NAME[lang],lang])}var comp=function(a,b){if(a[0]>b[0])return 1;if(a[0]<b[0])return-1;return 0};languages.sort(comp);document.title=MSG['title']};Code.discard=function(){var count=Code.workspace.getAllBlocks().length;if(count<2||window.confirm(Blockly.Msg.DELETE_ALL_BLOCKS.replace('%1',count))){Code.workspace.clear();cusnotify('success','mini',true,3000,MSG['DeleteBlocksSuccessful'].replace('%1',count));if(window.location.hash){window.location.hash=''}else{}}};$("#toolbox").load("blocks/blocks.xml",function(){Code.init();var b=function(){Code.workspace.updateToolbox($("#toolbox_xml")[0]);Code.workspace.toolbox_.flyout_.hide()};var a=(function(){var c=0;return function(e,d){clearTimeout(c);c=setTimeout(e,d)}})();$("#searchBlockForm").bind("keypress",function(c){if(c.keyCode==13){return false}});$(".searchSwitch").click(function(){$("#blocksearch_input").val("");b()});$("#blocksearch_input").keyup(function(c){a(function(){var h=$("#blocksearch_input").val().toLowerCase();if(h&&h.trim()!=""){var j=$("<xml>"+$("#toolbox")[0].innerHTML+"</xml>");var d=$('<xml><category colour="233" expanded="true" id="catSearchResult" name="搜索结果"></category></xml>');var f=d.find("category").eq(0);var m="block[type*="+h+"], block[data-keywords*="+h+"]";try{var k=j.find("category").find(m);k.clone().appendTo(f)}catch(l){}var g=1;while(g<1){j.children("category").eq(g++).clone().appendTo(f.parent())}Code.workspace.updateToolbox(d.appendTo("<xml></xml>").parent().html())}else{b()}},250)});b()});